To start Beeline;
/usr/lib/hive/bin/beeline
!connect jdbc:hive2://localhost:10000 username password org.apache.hive.jdbc.HiveDriver


create table StudentData (REFID INT, FIRSTNAME STRING, MIDDLENAME STRING, LASTNAME STRING, DOB STRING, SSN INT, GENDER STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
    > LINES TERMINATED BY '\n'
    > STORED AS TEXTFILE ("skip.header.line.count"="1");

create table StudentData (REFID INT, FIRSTNAME STRING, MIDDLENAME STRING, LASTNAME STRING, DOB STRING, SSN INT, GENDER STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' 
LINES TERMINATED BY '\n' 
STORED AS TEXTFILE tblproperties ("skip.header.line.count"="1");
------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE QUERIES
---------------------

CREATE TABLE MAININDEXTABLE (INDEXNAME STRING,SID STRING,INDEXSTRING STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' 
LINES TERMINATED BY '\n' STORED AS TEXTFILE TBLPROPERTIES("SKIP.HEADER.LINE.COUNT"="1");
------------------------------
CREATE TABLE NORMALIZEDMAININDEXTABLE (INDEXNAME STRING, SID STRING,INDEXSTRING STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' 
LINES TERMINATED BY '\n' STORED AS TEXTFILE;
------------------------------
QUERY TO NORMALIZE THE DATA FROM MAININDEXTABLE TO NORMALIZEDMAININDEXTABLE:
SPLIT QUERY USING EXPLODE() IN HIVE
Load data inpath '/user/cloudera/HiveDataFolder/MAININDEXTABLE.csv' into table MAININDEXTABLE;
-----------------------------
CREATE TABLE TESTEXPLODE (INDEXNAME STRING, SID STRING,INDEXSTRING ARRAY<STRING>);    //TESTEXPLODE CAN BE REPLACED BY NORMALIZEDMAININDEXTABLE
INSERT INTO TESTEXPLODE SELECT INDEXNAME,SID,SPLIT(INDEXSTRING,',') FROM MAININDEXTABLE;
INSERT INTO NORMALIZEDMAININDEXTABLE SELECT INDEXNAME, SID, INDEXSTR FROM TESTEXPLODE LATERAL VIEW EXPLODE(INDEXSTRING) INDEXTBL AS INDEXSTR;

CREATE TABLE MAINTCOVERLAP (INDEXSTRING STRING, SID1 STRING,SID2 STRING);

INSERT INTO MAINTCOVERLAP SELECT INDEXSTRING1, SID1, SID2 FROM (SELECT A.INDEXSTRING AS INDEXSTRING1,B.INDEXSTRING AS INDEXSTRING2, A.SID AS SID1, B.SID AS SID2 FROM NORMALIZEDMAININDEXTABLE A,NORMALIZEDMAININDEXTABLE B WHERE A.INDEXSTRING=B.INDEXSTRING AND A.INDEXNAME IN ('Index_1', 'Index_2')) AS E WHERE E.SID1 <> E.SID2 AND E.INDEXSTRING1=E.INDEXSTRING2;

CREATE TABLE TCCANDIDATES (INDEXNAME STRING, SID STRING, INDEXSTRING STRING);
INSERT INTO TCCANDIDATES SELECT INDEXNAME, SID, INDEXSTRING FROM MAININDEXTABLE WHERE MAININDEXTABLE.SID IN(SELECT SID1 AS SID3 FROM MAINTCOVERLAP UNION ALL SELECT SID2 AS SID3 FROM MAINTCOVERLAP);

CREATE TABLE NONTCCANDIDATES (INDEXNAME STRING, SID STRING, INDEXSTRING STRING);
INSERT INTO NONTCCANDIDATES SELECT INDEXNAME, SID, INDEXSTRING FROM MAININDEXTABLE WHERE MAININDEXTABLE.SID NOT IN(SELECT SID1 AS SID3 FROM MAINTCOVERLAP UNION ALL SELECT SID2 AS SID3 FROM MAINTCOVERLAP);


CREATE TABLE TCOUTPUT (SID STRING, REFIDS STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' LINES TERMINATED BY '\n' STORED AS TEXTFILE;
LOAD DATA INPATH '/user/cloudera/HiveDataFolder/TCOUTPUT.csv' into table TCOUTPUT;

CREATE TABLE PREFINALTCOP (SID STRING, REFIDS STRING);
INSERT INTO PREFINALTCOP SELECT SID, INDEXSTRING AS REFSTR FROM NONTCCANDIDATES UNION ALL SELECT SID, REFIDS AS REFSTR FROM TCOUTPUT;

CREATE TABLE FINALTCOP (SID STRING, REFIDS STRING);
INSERT INTO FINALTCOP SELECT DISTINCT * FROM PREFINALTCOP;

CREATE TABLE FINALTCOPARRAY (SID STRING, REFIDS ARRAY<STRING>);
INSERT INTO FINALTCOPARRAY SELECT SID, SPLIT(REFIDS, ',') FROM FINALTCOP WHERE REFIDS LIKE '%,%';


CREATE TABLE CANDIDATEINDEX (SID STRING, SOURCEID STRING);
INSERT INTO CANDIDATEINDEX SELECT SID, SOURCEREF FROM FINALTCOPARRAY LATERAL VIEW EXPLODE(REFIDS) TCOPINDREF AS SOURCEREF;


CREATE TABLE NONCANDIDATEINDEX (SID STRING, SOURCEID STRING);
INSERT INTO NONCANDIDATEINDEX SELECT * FROM FINALTCOP WHERE FINALTCOP.SID NOT IN (SELECT SID FROM CANDIDATEINDEX);

CREATE TABLE IDENTITYRESOLUTIONTEMP (REFID STRING, FIRSTNAME STRING, MIDDLENAME STRING, LASTNAME STRING, SSN STRING,DOB STRING, GENDER STRING, REMAININGDATA STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY '|' LINES TERMINATED BY '\N';
LOAD DATA INPATH '/user/cloudera/HiveDataFolder/IDENTITYRESOLUTIONTEMP.csv' into table IDENTITYRESOLUTIONTEMP;

CREATE TABLE CANDIDATEDATANEW (SID STRING, REFID STRING, FIRSTNAME STRING, MIDDLENAME STRING, LASTNAME STRING, SSN STRING, DOB STRING, GENDER STRING);

INSERT INTO CANDIDATEDATANEW SELECT DISTINCT SID, REFID, FIRSTNAME, MIDDLENAME, LASTNAME, SSN, DOB, GENDER FROM CANDIDATEINDEX , IDENTITYRESOLUTIONTEMP WHERE CANDIDATEINDEX.SOURCEID =IDENTITYRESOLUTIONTEMP.REFID;




TRUNCATE TABLE MAININDEXTABLE;
TRUNCATE TABLE TESTEXPLODE;
TRUNCATE TABLE NORMALIZEDMAININDEXTABLE;
TRUNCATE TABLE MAINTCOVERLAP;
TRUNCATE TABLE TCCANDIDATES;
TRUNCATE TABLE NONTCCANDIDATES;
TRUNCATE TABLE TCOUTPUT;
TRUNCATE TABLE PREFINALTCOP;
TRUNCATE TABLE FINALTCOP;
TRUNCATE TABLE FINALTCOPARRAY;
TRUNCATE TABLE CANDIDATEINDEX;
TRUNCATE TABLE NONCANDIDATEINDEX;
TRUNCATE TABLE IDENTITYRESOLUTIONTEMP;
TRUNCATE TABLE CANDIDATEDATANEW;





SID1 REFID1
SID1 REFID2

REFID1 fnam1 lnmae1
Refid2 fnam lname

